{% set settings_active = True %}
{% extends 'base.html' %}

{% block content %}
<div class="container">
  <form action="{{ url_for('data_handler') }}" method="post">
    <div class="row justify-content-center">
      <div class="card rounded-lg px-0 py-0 my-1">
        <div class="card-header px-1 py-1">Personal Details</div>
        <div class="card-body px-1 py-1">
          <div>
            <table>
              <tr><td>
                <table>
              <tr><td><span class="form-group"><label class="small" for="inputName">Name</label></td><td><input class="form-control py-1" id="inputName" type="name" value="John Smith" readOnly name='patient_name' /></span></td></tr>
              <tr><td><span class="form-group"><label class="small" for="inputEmailAddress">Age</label></td><td><input class="form-control py-1" id="inputAge" type="number" readOnly placeholder=87 /></span></td></tr>
                </table></td>
                <td>
                  <table>
              <tr><td><span class="form-group"><label class="small" for="inputHeight">Height (cm)</label></td><td><input class="form-control py-1" id="inputHeight" type="number" readOnly placeholder=180 /></span></td></tr>
              <tr><td><span class="form-group"><label class="small" for="inputWeight">Weight (kg)</label></td><td><input class="form-control py-1" id="inputWeight" type="number" readOnly placeholder=80 /></span></td></tr>
                  </table></td>
                </tr>
            </table>
            </div> 
        </div>
      </div>
    </div>
        <div class="card-body px-1 py-1">
          <div>
          <form action="{{ url_for('data_handler') }}" method="post">
            <table>
              <tr><td>
                <table>
              <tr>
                <td> <label class="small" for="inputVar1" >Buffer fill [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_fill" type="number" value="1"  onclick="show_easy_numpad(this, buff_fill_controller);lock();"  readOnly disabled/></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar2">Buffer flush [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_flush" type="number" value="1"   onclick="show_easy_numpad(this, buff_flush_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar3">Buffer loaded [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_loaded" type="number" value="1"   onclick="show_easy_numpad(this, buff_loaded_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar4">Buffer pre-fill [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_prefill" type="number" value="1"   onclick="show_easy_numpad(this, buff_prefill_controller);lock();"  readOnly disabled/></td>

                
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar5">Buffer pre-inhale [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_preinhale" type="number" value="1"   onclick="show_easy_numpad(this, buff_preinhale_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar6">Buffer purge [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="buff_purge" type="number" value="1"   onclick="show_easy_numpad(this, buff_purge_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar7">Inhale [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="inhale" type="number" value="1"   onclick="show_easy_numpad(this, inhale_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar8">Pause [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pause" type="number" value="1"   onclick="show_easy_numpad(this, pause_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar9">Exhale [ms]</label></td>
                  <td><input class="form-control py-1 input-editable" id="exhale" type="number" value="1"   onclick="show_easy_numpad(this, exhale_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr><td><span class="form-group"><label class="small" for="inputVar10">Exhale fill[ms]</label></td>
              <td><input class="form-control py-1 input-editable" id="exhale_fill" type="number" value="1"   onclick="show_easy_numpad(this, exhale_fill_controller);lock();"  readOnly disabled/></td>

              <tr><td><span class="form-group"><label class="small" for="inputVar13">Calibration [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="calibration" type="number" value="1"   onclick="show_easy_numpad(this, calibration_controller);lock();"  readOnly disabled/></td>
    

            </table>
          </td>
          <td>
            <table>

          <tr><td><span class="form-group"><label class="small" for="inputVar11">Valve (Air)</label></td>
            <td><input class="form-control py-1" id="valve_air" type="number" value="1"   onclick="show_easy_numpad(this, valve_air_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar12">Valve (O2)</label></td>
            <td><input class="form-control py-1" id="valve_o2" type="number" value="1"   onclick="show_easy_numpad(this, valve_02_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Inhale) [%]</label></td>
            <td><input class="form-control py-1" id="valve_inhale" type="number" value="1"   onclick="show_easy_numpad(this, valve_inhale_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Exhale) [%]</label></td>
            <td><input class="form-control py-1" id="valve_exhale" type="number" value="1"   onclick="show_easy_numpad(this, valve_exhale_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Purge)</label></td>
            <td><input class="form-control py-1" id="valve_exhale" type="number" value="1"   onclick="show_easy_numpad(this, valve_purge_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">PEEP [cmH2O]</label></td>
            <td><input class="form-control py-1" id="peep" type="number" value="1"   onclick="show_easy_numpad(this, purge_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">State</label></td>
            <td><input class="form-control py-1" id="state" type="number" value="1"   onclick="show_easy_numpad(this, state_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">RPM</label></td>
            <td><input class="form-control py-1" id="rpm" type="number" value="1"   onclick="show_easy_numpad(this, rpm_controller);lock();"  readOnly disabled/></td>

          <tr><td><span class="form-group"><label class="small" for="inputVar13">Inhale:Exhale</label></td>
            <td><input class="form-control py-1" id="inhale_exhale" type="number" value="1"   onclick="show_easy_numpad(this, inhale_exhale_controller);lock();"  readOnly disabled/></td>

            </table></td>
          </tr>
          </table>
          </div>
        </div>
    <div class="row justify-content-center">
          <span class="form-group" ><input class="form-button py-2" id="inputPassword" type="submit" value="Submit Changes"  /></span>
    </div>
  </form>
</div>
{% endblock %}

{% block body_scripts %}
<script type=text/javascript>


function sendCmd(var_name, var_value) {
  var buffer = {name : var_name, value : var_value};
  $.ajax({
        type: "POST",
        url:"/data_handler",
        data: JSON.stringify(buffer)   // converts js value to JSON string
        })    
};




  class input_controller{
	constructor(name, element) {
    this.name = name;
	this.element = element;
  }
  getName(){ return this.name;}
  getValue() {
    return this.element.value;
  }
  setValue(val){
    //e.g.
    window.createNotification({
			closeOnClick: 1,
			displayCloseButton: 0,
			positionClass: "nfc-bottom-right",
			showDuration: false,
			theme: "info"
		})({
			title: "Updated settings",
			message: "Setting updated from " + this.element.value + " to " + val + " for " + this.name
	  });
	  this.element.value = val;
    sendCmd(this.name, val);
  }
  getMin(){
	  if (this.element.min) return this.element.min;
	  else return null;
  }
  getMax(){
	  if (this.element.max) return this.element.max;
	  else return null;
  }
}

buff_fill_controller = new input_controller("buff_fill", document.getElementById("buff_fill"));
buff_flush_controller = new input_controller("buff_flush", document.getElementById("buff_flush"));
buff_loaded_controller = new input_controller("buff_loaded", document.getElementById("buff_loaded"));
buff_prefill_controller = new input_controller("buff_prefill", document.getElementById("buff_prefill"));
buff_preinhale_controller = new input_controller("buff_pre_inhale", document.getElementById("buff_pre_inhale"));
buff_purge_controller = new input_controller("buff_purge", document.getElementById("buff_purge"));
inhale_controller = new input_controller("inhale", document.getElementById("inhale"));
pause_controller = new input_controller("pause", document.getElementById("pause"));
exhale_controller = new input_controller("exhale", document.getElementById("exhale"));
exhale_fill_controller = new input_controller("exhale_fill", document.getElementById("exhale_fill"));


//valve_air_controller = new input_controller("valve_air", document.getElementById("valve_air"));
//valve_o2_controller = new input_controller("valve_o2", document.getElementById("valve_o2"));
//valve_inhale_controller = new input_controller("valve_inhale", document.getElementById("valve_inhale"));
//valve_exhale_controller = new input_controller("valve_exhale", document.getElementById("valve_exhale"));
//peep_controller = new input_controller("peep", document.getElementById("peep"));
//state_controller = new input_controller("state", document.getElementById("state"));
//rpm_controller = new input_controller("rpm", document.getElementById("rpm"));
//inhale_exhale_controller = new input_controller("inhale_exhale", document.getElementById("inhale_exhale"));
calibration_controller = new input_controller("calibration", document.getElementById("calibration"));



</script>

{% endblock %}
