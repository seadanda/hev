{% set settings_active = True %}
{% extends 'base.html' %}

{% block content %}
<div class="container">
  <form action="{{ url_for('data_handler') }}" method="post">
    <div class="row justify-content-center">
      <div class="card rounded-lg px-0 py-0 my-1">
        <div class="card-header px-1 py-1">Personal Details</div>
        <div class="card-body px-1 py-1">
          <div>
            <table>
              <tr><td>
                <table>
              <tr><td><span class="form-group"><label class="small" for="inputName">Name</label></td><td><input class="form-control py-1" id="inputName" type="name" value="John Smith" readOnly name='patient_name' /></span></td></tr>
              <tr><td><span class="form-group"><label class="small" for="inputEmailAddress">Age</label></td><td><input class="form-control py-1" id="inputAge" type="number" readOnly placeholder=87 /></span></td></tr>
                </table></td>
                <td>
                  <table>
              <tr><td><span class="form-group"><label class="small" for="inputHeight">Height (cm)</label></td><td><input class="form-control py-1" id="inputHeight" type="number" readOnly placeholder=180 /></span></td></tr>
              <tr><td><span class="form-group"><label class="small" for="inputWeight">Weight (kg)</label></td><td><input class="form-control py-1" id="inputWeight" type="number" readOnly placeholder=80 /></span></td></tr>
                  </table></td>
                </tr>
            </table>
            </div> 
        </div>
      </div>
    </div>
        <div class="card-body px-1 py-1">
          <div>
          <form action="{{ url_for('data_handler') }}" method="post">
            <table>
              <tr><td>
                <table>
              <tr>
                <td> <label class="small" for="inputVar1" >Buffer fill [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_air_supply" type="number" value="11" name="timeout_threshold"  onclick="show_easy_numpad(this, buffer_fill_controller);lock();"  readOnly disabled/></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar2">Buffer flush [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_air_regulated" type="number" value="1" name="timeout_threshold"  onclick="show_easy_numpad(this, buffer_flush_controller);lock();"  readOnly disabled/></td>

              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar3">Buffer loaded [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_o2_supply" type="number" value=1 name="variable3"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar4">Buffer pre-fill [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_o2_regulated" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar5">Buffer pre-inhale [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_buffer" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar6">Buffer purge [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_inhale" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar7">Inhale [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="pressure_patient" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar8">Pause [ms]</label></td>
                <td><input class="form-control py-1 input-editable" id="readback_valve_air_in" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr>
                <td><span class="form-group"><label class="small" for="inputVar9">Exhale [ms]</label></td>
                  <td><input class="form-control py-1 input-editable" id="readback_valve_02_in" type="number" value=1 name="variable4"  /></span></td>
              </tr>
              <tr><td><span class="form-group"><label class="small" for="inputVar10">Exhale fill[ms]</label></td><td><input class="form-control py-1 input-editable" id="readback_valve_out" type="number" value=1 name="variable5"  /></span></td></tr>

            </table>
          </td>
          <td>
            <table>

          <tr><td><span class="form-group"><label class="small" for="inputVar11">Vavle (Air)</label></td><td><input class="form-control py-1 input-editable" id="readback_valve_scavenge" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar12">Valve (O2)</label></td><td><input class="form-control py-1 input-editable" id="readback_valve_purge" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Inhale) [%]</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Exhale) [%]</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">Valve (Purge)</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">PEEP [cmH2O]</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">State</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">RPM</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">Inhale:Exhale</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
          <tr><td><span class="form-group"><label class="small" for="inputVar13">Calibration [ms]</label></td><td><input class="form-control py-1 input-editable" id="readback_mode" type="number" value=1 name="variable6"  /></span></td></tr>
            </table></td>
          </tr>
          </table>
          </div>
        </div>
    <div class="row justify-content-center">
          <span class="form-group" ><input class="form-button py-2" id="inputPassword" type="submit" value="Submit Changes"  /></span>
    </div>
  </form>
</div>
{% endblock %}

{% block body_scripts %}
<script type=text/javascript>


function sendCmd(var_name, var_value) {
  var buffer = {name : var_name, value : var_value};
  $.ajax({
        type: "POST",
        url:"/data_handler",
        data: JSON.stringify(buffer)   // converts js value to JSON string
        })    
};




  class input_controller{
	constructor(name, element) {
    this.name = name;
	this.element = element;
  }
  getName(){ return this.name;}
  getValue() {
    return this.element.value;
  }
  setValue(val){
    //e.g.
    window.createNotification({
			closeOnClick: 1,
			displayCloseButton: 0,
			positionClass: "nfc-bottom-right",
			showDuration: false,
			theme: "info"
		})({
			title: "Updated settings",
			message: "Setting updated from " + this.element.value + " to " + val + " for " + this.name
	  });
	  this.element.value = val;
    sendCmd(this.name, val);
  }
  getMin(){
	  if (this.element.min) return this.element.min;
	  else return null;
  }
  getMax(){
	  if (this.element.max) return this.element.max;
	  else return null;
  }
}

buffer_fill_controller = new input_controller("buffer_fill", document.getElementById("pressure_air_supply"));
buffer_flush_controller = new input_controller("buffer_fill", document.getElementById("pressure_air_regulated"));


</script>

{% endblock %}
